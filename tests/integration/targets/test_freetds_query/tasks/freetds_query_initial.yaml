- vars:
    freetds_parameters: &freetds_params
      login_user: '{{ freetds.user }}'
      login_password: '{{ freetds.password }}'
      login_host: '{{ freetds.host }}'
      login_port: '{{ freetds.port }}'
      odbc_driver: 'FreeTDS'

  block:
  
  # - name: Display ODBC driver configuration
  #   shell: |
  #     odbcinst -j && \
  #     cat /etc/odbcinst.ini
      
  
  - name: Get database engine version
    freetds_query:
      <<: *freetds_params
      query: 'select @@version'
      login_db: 'master'
    register: result

  - name: Create db
    freetds_query:
      <<: *freetds_params
      query: 'create database {{ freetds.database.test.name }} on {{ freetds.database.initial }} = {{freetds.database.test.size }}'
    register: result